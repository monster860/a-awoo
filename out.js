(()=>{"use strict";var t={576:t=>{t.exports=JSON.parse('{"compressionlevel":-1,"height":17,"infinite":false,"layers":[{"data":[8,7,8,0,0,0,0,8,10,9,8,8,7,10,8,10,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,1,1,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,1,1,1,1,1,2,2,2,2,2,2,1,0,1,2,2,1,2,2,2,2,2,2,2,2,2,2,1,0,1,2,2,1,2,2,2,2,2,2,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"height":17,"id":1,"name":"Background","opacity":1,"type":"tilelayer","visible":true,"width":16,"x":0,"y":0},{"draworder":"topdown","id":2,"name":"Objects","objects":[{"height":0,"id":4,"name":"","point":true,"rotation":0,"type":"spawn","visible":true,"width":0,"x":160,"y":416},{"height":0,"id":6,"name":"","point":true,"properties":[{"name":"is_on","type":"bool","value":true},{"name":"target_tag","type":"string","value":"gate1|!backup_blocker"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":288,"y":160},{"height":0,"id":7,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":0},{"name":"dy","type":"float","value":0},{"name":"gate_type","type":"string","value":"wood_4"},{"name":"rotation_final","type":"float","value":90},{"name":"rotation_initial","type":"float","value":0},{"name":"tag","type":"string","value":"gate1"},{"name":"transition_time","type":"float","value":0.5}],"rotation":0,"type":"gate","visible":true,"width":0,"x":96,"y":64},{"height":0,"id":8,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":-128},{"name":"dy","type":"float","value":0},{"name":"gate_type","type":"string","value":"wood_4"},{"name":"rotation_final","type":"float","value":120},{"name":"rotation_initial","type":"float","value":0},{"name":"tag","type":"string","value":"skylight"},{"name":"transition_time","type":"float","value":4}],"rotation":0,"type":"gate","visible":true,"width":0,"x":224,"y":48},{"height":0,"id":9,"name":"","point":true,"properties":[{"name":"facing_right","type":"bool","value":false},{"name":"target_tag","type":"string","value":"skylight"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":480,"y":288},{"height":0,"id":10,"name":"","polygon":[{"x":-96,"y":-32},{"x":-96,"y":512},{"x":416,"y":512},{"x":416,"y":352},{"x":384,"y":352},{"x":384,"y":288},{"x":416,"y":288},{"x":416,"y":-32},{"x":128,"y":-32},{"x":128,"y":32},{"x":192,"y":32},{"x":192,"y":128},{"x":96,"y":128},{"x":96,"y":160},{"x":224,"y":160},{"x":224,"y":32},{"x":384,"y":32},{"x":384,"y":256},{"x":256,"y":256},{"x":256,"y":288},{"x":352,"y":288},{"x":352,"y":352},{"x":224,"y":352},{"x":224,"y":384},{"x":32,"y":384},{"x":32,"y":320},{"x":160,"y":320},{"x":160,"y":288},{"x":32,"y":288},{"x":32,"y":160},{"x":0,"y":160},{"x":0,"y":416},{"x":384,"y":416},{"x":384,"y":480},{"x":-64,"y":480},{"x":-64,"y":32},{"x":0,"y":32},{"x":0,"y":-32}],"rotation":0,"type":"","visible":true,"width":0,"x":96,"y":32},{"height":0,"id":11,"name":"","point":true,"rotation":0,"type":"exit","visible":true,"width":0,"x":448,"y":512},{"height":0,"id":13,"name":"","point":true,"properties":[{"name":"target_tag","type":"string","value":"gate1|backup_blocker"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":448,"y":384},{"height":0,"id":14,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":0},{"name":"dy","type":"float","value":-16},{"name":"gate_type","type":"string","value":"wood_2"},{"name":"rotation_final","type":"float","value":270},{"name":"rotation_initial","type":"float","value":90},{"name":"tag","type":"string","value":"backup_blocker"},{"name":"transition_time","type":"float","value":1}],"rotation":0,"type":"gate","visible":true,"width":0,"x":352,"y":320}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":15,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.4.3","tileheight":32,"tilesets":[{"firstgid":1,"source":"tileset.json"}],"tilewidth":32,"type":"map","version":1.4,"width":16}')},784:t=>{t.exports=JSON.parse('{"compressionlevel":-1,"height":30,"infinite":false,"layers":[{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,8,10,10,2,2,2,1,1,2,2,7,7,8,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,6,6,1,2,2,2,2,2,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,3,5,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,1,2,2,2,2,2,2,2,1,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1,1,1,2,2,2,2,2,1,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,1,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,5,5,1,2,2,2,2,2,2,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,3,4,1,2,2,2,2,2,1,1,2,2,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,6,1,1,1,0,0,0,0,0,0,0,0,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,3,4,5,4,5,0,0,0,0,0,0,0,0,6,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,3,6,3,3,0,0,0,0,0,0,0,0,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,6,6,3,5,0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":30,"id":1,"name":"Background","opacity":1,"type":"tilelayer","visible":true,"width":30,"x":0,"y":0},{"draworder":"topdown","id":2,"name":"Objects","objects":[{"height":0,"id":1,"name":"","point":true,"rotation":0,"type":"spawn","visible":true,"width":0,"x":416,"y":544},{"height":0,"id":2,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":0},{"name":"dy","type":"float","value":-8},{"name":"gate_type","type":"string","value":"wood_4"},{"name":"rotation_final","type":"float","value":-180},{"name":"rotation_initial","type":"float","value":0},{"name":"tag","type":"string","value":"gate1"},{"name":"transition_time","type":"float","value":0.5}],"rotation":0,"type":"gate","visible":true,"width":0,"x":352,"y":376},{"height":0,"id":3,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":0},{"name":"dy","type":"float","value":-8},{"name":"gate_type","type":"string","value":"wood_4"},{"name":"rotation_final","type":"float","value":180},{"name":"rotation_initial","type":"float","value":0},{"name":"tag","type":"string","value":"gate2"},{"name":"transition_time","type":"float","value":0.5}],"rotation":0,"type":"gate","visible":true,"width":0,"x":352,"y":552},{"height":0,"id":4,"name":"","point":true,"properties":[{"name":"target_tag","type":"string","value":"gate1"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":512,"y":480},{"height":0,"id":5,"name":"","polygon":[{"x":0,"y":-32},{"x":0,"y":-64},{"x":-64,"y":-64},{"x":-64,"y":-32}],"rotation":0,"type":"","visible":true,"width":0,"x":320,"y":288},{"height":0,"id":6,"name":"","polyline":[{"x":-32,"y":32},{"x":-32,"y":64},{"x":-128,"y":64},{"x":-128,"y":192},{"x":-64,"y":192},{"x":-64,"y":320},{"x":32,"y":320},{"x":32,"y":288},{"x":-32,"y":288},{"x":-32,"y":160},{"x":-96,"y":160},{"x":-96,"y":96},{"x":-32,"y":96},{"x":0,"y":96},{"x":0,"y":0},{"x":-32,"y":0}],"rotation":0,"type":"","visible":true,"width":0,"x":192,"y":256},{"height":0,"id":7,"name":"","polygon":[{"x":0,"y":0},{"x":-160,"y":0},{"x":-160,"y":32},{"x":-32,"y":32},{"x":-32,"y":224},{"x":-96,"y":224},{"x":-96,"y":288},{"x":-64,"y":288},{"x":-64,"y":256},{"x":0,"y":256}],"rotation":0,"type":"","visible":true,"width":0,"x":544,"y":256},{"height":0,"id":8,"name":"","polygon":[{"x":0,"y":-12.8},{"x":-64,"y":-12.8},{"x":-64,"y":51.2},{"x":0,"y":51.2}],"rotation":0,"type":"","visible":true,"width":0,"x":384,"y":396.8},{"height":0,"id":9,"name":"","point":true,"properties":[{"name":"facing_right","type":"bool","value":true},{"name":"target_tag","type":"string","value":"gate2"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":160,"y":544},{"height":0,"id":10,"name":"","polygon":[{"x":0,"y":-6.4},{"x":-64,"y":-6.4},{"x":-64,"y":25.6},{"x":0,"y":25.6}],"rotation":0,"type":"","visible":true,"width":0,"x":384,"y":518.4},{"height":0,"id":11,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":8},{"name":"dy","type":"float","value":-8},{"name":"gate_type","type":"string","value":"wood_2"},{"name":"rotation_final","type":"float","value":0},{"name":"rotation_initial","type":"float","value":-90},{"name":"tag","type":"string","value":"passage"},{"name":"transition_time","type":"float","value":0.5}],"rotation":0,"type":"gate","visible":true,"width":0,"x":376,"y":520},{"height":0,"id":12,"name":"","point":true,"properties":[{"name":"target_tag","type":"string","value":"passage"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":320,"y":544},{"height":0,"id":14,"name":"","point":true,"rotation":0,"type":"exit","visible":true,"width":0,"x":128,"y":416},{"height":0,"id":16,"name":"","polyline":[{"x":0,"y":0},{"x":0,"y":-448},{"x":128,"y":-448}],"rotation":0,"type":"","visible":true,"width":0,"x":32,"y":672},{"height":0,"id":17,"name":"","polyline":[{"x":0,"y":0},{"x":0,"y":-32},{"x":160,"y":-32}],"rotation":0,"type":"","visible":true,"width":0,"x":384,"y":256}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":18,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.4.3","tileheight":32,"tilesets":[{"firstgid":1,"source":"tileset.json"}],"tilewidth":32,"type":"map","version":1.4,"width":30}')},177:t=>{t.exports=JSON.parse('{"compressionlevel":-1,"height":20,"infinite":false,"layers":[{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,5,1,2,2,2,2,2,2,1,2,2,2,2,1,4,3,3,3,5,6,6,1,2,2,2,2,2,2,2,2,2,2,2,1,6,5,4,6,6,3,3,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,6,4,3,1,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,1,5,6,5,1,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,1,5,5,6,1,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,1,3,5,4,1,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,1,6,4,4,1,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,5,6,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,6,5,3,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,6,5,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":20,"id":1,"name":"Background","opacity":1,"type":"tilelayer","visible":true,"width":20,"x":0,"y":0},{"draworder":"topdown","id":2,"name":"Objects","objects":[{"height":0,"id":14,"name":"","polygon":[{"x":0,"y":32},{"x":0,"y":0},{"x":-96,"y":0},{"x":-96,"y":160},{"x":320,"y":160},{"x":320,"y":224},{"x":-160,"y":224},{"x":-160,"y":128},{"x":-224,"y":128},{"x":-224,"y":-96},{"x":-32,"y":-96},{"x":-32,"y":-64},{"x":0,"y":-64},{"x":0,"y":-128},{"x":-288,"y":-128},{"x":-288,"y":-96},{"x":-256,"y":-96},{"x":-256,"y":160},{"x":-192,"y":160},{"x":-192,"y":256},{"x":352,"y":256},{"x":352,"y":128},{"x":288,"y":128},{"x":288,"y":-32},{"x":160,"y":-32},{"x":160,"y":-96},{"x":352,"y":-96},{"x":352,"y":-128},{"x":128,"y":-128},{"x":128,"y":0},{"x":256,"y":0},{"x":256,"y":128},{"x":-64,"y":128},{"x":-64,"y":32}],"rotation":0,"type":"","visible":true,"width":0,"x":288,"y":256},{"height":0,"id":15,"name":"","point":true,"rotation":0,"type":"spawn","visible":true,"width":0,"x":256,"y":384},{"height":0,"id":17,"name":"","polyline":[{"x":280,"y":-833.333333333333},{"x":248,"y":-865.333333333333}],"rotation":0,"type":"","visible":true,"width":0,"x":608,"y":608},{"height":0,"id":21,"name":"","point":true,"properties":[{"name":"facing_right","type":"bool","value":false},{"name":"target_tag","type":"string","value":"skylight"}],"rotation":0,"type":"switch","visible":true,"width":0,"x":544,"y":384},{"height":0,"id":25,"name":"","point":true,"rotation":0,"type":"exit","visible":true,"width":0,"x":576,"y":480},{"height":0,"id":26,"name":"","point":true,"properties":[{"name":"dx","type":"float","value":-128},{"name":"dy","type":"float","value":0},{"name":"gate_type","type":"string","value":"wood_4"},{"name":"rotation_final","type":"float","value":30},{"name":"rotation_initial","type":"float","value":0},{"name":"tag","type":"string","value":"skylight"},{"name":"transition_time","type":"float","value":0.5}],"rotation":0,"type":"gate","visible":true,"width":0,"x":416,"y":128},{"height":0,"id":31,"name":"","polyline":[{"x":0,"y":0},{"x":0,"y":-352},{"x":32,"y":-352}],"rotation":0,"type":"","visible":true,"width":0,"x":0,"y":512}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":32,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.4.3","tileheight":32,"tilesets":[{"firstgid":1,"source":"tileset.json"}],"tilewidth":32,"type":"map","version":1.4,"width":20}')},874:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PhysicsObject=e.Line=void 0;const a=i(607),s=i(647);e.Line=class{constructor(t,e,i,a){this.x1=t,this.y1=e,this.x2=i,this.y2=a}instersect_ray(t,e,i,a){let s=i*i+a*a,o=-a*(this.x1-t)+i*(this.y1-e),n=-a*(this.x2-t)+i*(this.y2-e);if(n>=0&&o<=0&&n!=o){let h=i*(this.x1-t)+a*(this.y1-e),r=(-o*((i*(this.x2-t)+a*(this.y2-e)-h)/(n-o))+h)/s;if(r>0)return r}return null}};class o extends s.MapObject{constructor(t=0,e=0,i,a=0,s=0,o=32,n=32){super(t,e,i),this.velocity_x=0,this.velocity_y=0,this.touching_floor=!1,this.bound_width=o,this.bound_height=n,this.bound_x=a,this.bound_y=s}simulate(t){this.x+=this.velocity_x*t,this.y+=this.velocity_y*t+2e3*t*t,this.velocity_y+=4e3*t,this.touching_floor=!1;let e=0;for(let t of a.game_instance.lines){if(t.x2>=t.x1)continue;let i=(t.y1-t.y2)/(t.x1-t.x2);if(Math.abs(i)>1)continue;if(t.x2>=this.x+this.bound_x+this.bound_width||t.x1<=this.x+this.bound_x)continue;let a=this.x+this.bound_x,s=this.y+this.bound_y+this.bound_height,o=Math.min(t.y1,t.y2);i<0&&(a+=this.bound_width);let n=i*(a-t.x2)+t.y2,h=!1;if(n<=o&&(n=o,h=!0),s>=n&&s<=n+10)if(this.touching_floor=!0,this.y+=n-s,h)e=Math.abs(this.velocity_y),this.velocity_y=0;else{let i=this.velocity_x,a=this.velocity_y,s=t.x1-t.x2,o=t.y1-t.y2,n=1/Math.sqrt(s*s+o*o);s*=n,o*=n;let h=i*s+a*o;this.velocity_x=s*h,this.velocity_y=o*h;let r=this.velocity_x-i,l=this.velocity_y-a;e+=Math.sqrt(r*r+l*l)}}if(this.touching_floor&&(0!=this.velocity_x||0!=this.velocity_y)){let t=Math.sqrt(this.velocity_x*this.velocity_x+this.velocity_y*this.velocity_y),i=1-Math.min(1,10*e/t);this.velocity_x*=i,this.velocity_y*=i}let i=[];for(let t of a.game_instance.lines){if(Math.min(t.x1,t.x2)>=this.x+this.bound_x+this.bound_width)continue;if(Math.max(t.x1,t.x2)<=this.x+this.bound_x)continue;if(Math.min(t.y1,t.y2)>=this.y+this.bound_y+this.bound_height)continue;if(Math.max(t.y1,t.y2)<=this.y+this.bound_y)continue;let e=t.y1-t.y2,a=t.x2-t.x1,s=1/Math.sqrt(e*e+a*a);e*=s,a*=s;let o=-1;for(let i=0;i<2;i++)for(let s=0;s<2;s++){let n=this.x+this.bound_x+this.bound_width*i,h=this.y+this.bound_y+this.bound_height*s,r=-((n-t.x1)*e+(h-t.y1)*a);r>=0&&r>o&&(o=r)}o>=0&&o<=16&&i.push([t,o])}i.sort(((t,e)=>t[1]-e[1]));for(let[t]of i){if(Math.min(t.x1,t.x2)>=this.x+this.bound_x+this.bound_width)continue;if(Math.max(t.x1,t.x2)<=this.x+this.bound_x)continue;if(Math.min(t.y1,t.y2)>=this.y+this.bound_y+this.bound_height)continue;if(Math.max(t.y1,t.y2)<=this.y+this.bound_y)continue;let e=t.y1-t.y2,i=t.x2-t.x1,a=1/Math.sqrt(e*e+i*i);e*=a,i*=a;let s=-1;for(let a=0;a<2;a++)for(let o=0;o<2;o++){let n=this.x+this.bound_x+this.bound_width*a,h=this.y+this.bound_y+this.bound_height*o,r=-((n-t.x1)*e+(h-t.y1)*i);r>=0&&r>s&&(s=r)}if(s>=0&&s<=16){this.x+=s*e,this.y+=s*i;let t=this.velocity_x*e+this.velocity_y*i;this.velocity_x-=t*e,this.velocity_y-=t*i}}}draw(t){t.fillStyle="red",t.fillRect(this.x+this.bound_x,this.y+this.bound_y,this.bound_width,this.bound_height)}}e.PhysicsObject=o},607:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.game_instance=e.Game=void 0;const a=i(874),s=i(509),o=i(688),n=i(647),h=i(251),r=i(761);class l{constructor(){this.zoom=1,this.lines=[],this.objects=[],this.tagged_objects=new Map,this.player=null,this.moon=null,this.last_time=-1,this.spawn_coordinates=[0,0],this.arrow_left=!1,this.arrow_right=!1,this.arrow_up=!1,this.arrow_down=!1,this.audio_ctx=new AudioContext,this.tileset_image=new Image,this.moon_image=new Image,this.title_image=new Image,this.awoo_playing=!1,this.awoo_sound=new r.Sound("awoo.ogg"),this.switch_on_sound=new r.Sound("switch_on.ogg"),this.switch_off_sound=new r.Sound("switch_off.ogg"),this.tiles=[],this.tiles_width=0,this.tiles_height=0,this.current_map_index=-1,this.next_map_index=null,this.next_map_fade=0,this.star_map=new Map,this.canvas=document.createElement("canvas"),this.tileset_image.src="tileset.png",this.moon_image.src="moon.png",this.title_image.src="title.png",window.addEventListener("DOMContentLoaded",this.dom_content_loaded.bind(this))}advance_map(t){this.next_map_index||(null==t&&(t=o.maps_list.length>this.current_map_index+1?this.current_map_index+1:-2),this.next_map_index=t)}load_map(t){var e,i;if(this.objects.length=0,this.lines.length=0,this.tagged_objects.clear(),this.current_map_index=t,t>=0){let r=o.maps_list[t];for(let t of r.layers)if("Objects"==t.name&&t.objects){let e=t.objects;for(let t of e){if(t.polygon)for(let e=0;e<t.polygon.length;e++){let i=e+1;i==t.polygon.length&&(i=0);let s=t.polygon[e],o=t.polygon[i];this.lines.push(new a.Line(t.x+s.x,t.y+s.y,t.x+o.x,t.y+o.y))}if(t.polyline)for(let e=0;e<t.polyline.length-1;e++){let i=e+1,s=t.polyline[e],o=t.polyline[i];this.lines.push(new a.Line(t.x+s.x,t.y+s.y,t.x+o.x,t.y+o.y))}"spawn"==t.type?this.spawn_coordinates=[t.x,t.y]:"switch"==t.type?this.objects.push(new n.SwitchObject(t.x,t.y,t.properties)):"gate"==t.type?this.objects.push(new n.GateObject(t.x,t.y,t.properties)):"exit"==t.type&&this.objects.push(new n.ExitObject(t.x,t.y,t.properties))}}else"Background"==t.name&&t.data&&(this.tiles_width=null!==(e=t.width)&&void 0!==e?e:0,this.tiles_height=null!==(i=t.height)&&void 0!==i?i:0,this.tiles=t.data);this.objects.push(this.player=new h.PlayerObject(this.spawn_coordinates[0],this.spawn_coordinates[1])),this.moon=new s.OrthoMoon}else this.moon=null,this.tiles_width=0,this.tiles_height=0,this.tiles=[]}simulate(t){null!=this.next_map_index?(this.next_map_fade=Math.min(this.next_map_fade+3*t,1),this.next_map_fade>=1&&(this.load_map(this.next_map_index),this.next_map_index=null)):this.next_map_fade=Math.max(this.next_map_fade-3*t,0),this.player&&this.player.y>1e3&&this.advance_map(this.current_map_index);for(let e of this.objects)e.simulate(t)}keydown(t){var e;if(this.audio_ctx.resume(),"ArrowLeft"!=t.code&&"KeyA"!=t.code||(this.arrow_left=!0),"ArrowRight"!=t.code&&"KeyD"!=t.code||(this.arrow_right=!0),"ArrowUp"!=t.code&&"KeyW"!=t.code&&"Space"!=t.code||(this.arrow_up=!0,null===(e=this.player)||void 0===e||e.jump()),"ArrowDown"!=t.code&&"KeyS"!=t.code||(this.arrow_down=!0),"KeyE"==t.code&&this.player&&!this.player.is_werewolf)for(let t of this.objects)t!=this.player&&t.in_interact_range(this.player.x,this.player.y)&&t.interact();-1==this.current_map_index&&"KeyE"==t.code&&this.advance_map(0),"KeyR"==t.code&&this.advance_map(this.current_map_index)}keyup(t){"ArrowLeft"!=t.code&&"KeyA"!=t.code||(this.arrow_left=!1),"ArrowRight"!=t.code&&"KeyD"!=t.code||(this.arrow_right=!1),"ArrowUp"!=t.code&&"KeyW"!=t.code&&"Space"!=t.code||(this.arrow_up=!1),"ArrowDown"!=t.code&&"KeyS"!=t.code||(this.arrow_down=!1)}frame(t){var e;for(-1==this.last_time&&(this.last_time=t),this.last_time<t-500&&(this.last_time=t-500);this.last_time<t;){let e=Math.min(this.last_time+5,t);this.simulate(.001*(e-this.last_time)),this.last_time=e}let i=this.canvas,a=i.getBoundingClientRect(),s=Math.round(a.width*window.devicePixelRatio),o=Math.round(a.height*window.devicePixelRatio);s==i.width&&o==i.height||(i.width=s,i.height=o);let n=i.getContext("2d");if(!n)throw new Error("No 2d rendering context somehow");n.setTransform(),n.clearRect(0,0,i.width,i.height),n.scale(2,2);let h=Math.round(2*(this.player?-this.player.x/4:0))/2,r=Math.round(2*(this.player?-this.player.y/4:0))/2;for(let t=32*Math.floor(-r/32);t<=-r+this.canvas.height/2;t+=32)for(let e=32*Math.floor(-h/32);e<=-h+this.canvas.width/2;e+=32){let i,a,s,o=this.star_map.get(e+","+t);if(o){let t=o.split(";");i=t[0],a=+t[1],s=+t[1]}else i=["#ffffff","#aaaa88","#8888ff","#88ffff"][Math.floor(4*Math.random())],a=Math.floor(32*Math.random()),s=Math.floor(32*Math.random()),this.star_map.set(e+","+t,i+";"+a+";"+s);n.fillStyle=i,n.fillRect(e+h+a,t+r+s,1,1)}n.drawImage(this.moon_image,200+h,100+r),this.player&&n.translate(Math.round(-this.player.x)+Math.round(this.canvas.width/2/2),Math.round(-this.player.y)+Math.round(2*this.canvas.height/3/2)),n.imageSmoothingEnabled=!1;for(let t=0;t<this.tiles_height;t++)for(let e=0;e<this.tiles_width;e++){let i=this.tiles[t*this.tiles_width+e]-1;if(i>=0){let a=i%16*32,s=32*Math.floor(i/16);n.drawImage(this.tileset_image,a,s,32,32,32*e,32*t,32,32)}}for(let t of this.objects)t.draw(n);null===(e=this.moon)||void 0===e||e.draw(n),-2==this.current_map_index?(n.fillStyle="white",n.font="Verdana 60px",n.textAlign="center",n.textBaseline="middle",n.fillText("You reached the end of the game",i.width/2/2,i.height/2/2),n.font="Verdana 30px",n.fillText("Yeee",i.width/2/2,i.height/2/2+60)):-1==this.current_map_index&&(n.drawImage(this.title_image,i.width/2/2-120,i.height/2/2-100),n.fillStyle="white",n.font="30px Verdana",n.textAlign="center",n.textBaseline="middle",n.fillText("Press E to play",i.width/2/2,i.height/2/2+50)),n.setTransform(),this.next_map_fade&&(n.fillStyle=`rgba(0,0,0,${this.next_map_fade})`,n.fillRect(0,0,i.width,i.height))}dom_content_loaded(){this.load_map(-1),document.body.appendChild(this.canvas),this.canvas.id="the_canvas",document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this)),window.requestAnimationFrame(this.frame_loop.bind(this))}frame_loop(t){try{this.frame(t)}catch(t){console.error(t),this.canvas.width=this.canvas.width}window.requestAnimationFrame(this.frame_loop.bind(this))}}e.Game=l,e.game_instance=new l,console.log(e.game_instance)},509:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OrthoMoon=void 0;const a=i(607);e.OrthoMoon=class{constructor(t=.32,e=1){this.ray_x=t,this.ray_y=e}get_moon_vector(t,e){return[-this.ray_x,-this.ray_y]}draw(t){let e=1/Math.sqrt(this.ray_x*this.ray_x+this.ray_y*this.ray_y);this.ray_x*=e,this.ray_y*=e;let i=this.ray_y,s=-this.ray_x,o=new Set,n=[];for(let t of a.game_instance.lines){let e=i*t.x1+s*t.y1,a=i*t.x2+s*t.y2,h=this.ray_x*t.x1+this.ray_y*t.y1,r=this.ray_x*t.x2+this.ray_y*t.y2;a<=e||(o.add(e),o.add(a),o.add(e+.1),o.add(a+.1),o.add(e-.1),o.add(a-.1),n.push([e,h,a,r,(r-h)/(a-e)]))}o.add(-6e3),o.add(6e3);let h=[...o].sort(((t,e)=>t-e));t.fillStyle="#333333",t.globalCompositeOperation="lighter",t.beginPath();let r=!0,l=0,y=0;for(let e of h){let a=6e3;for(let[t,i,s,o,h]of n){if(t>e||s<e)continue;let o=(e-t)*h+i;o<a&&(a=o)}a!=1/0&&(l=a*this.ray_x+i*e,y=a*this.ray_y+s*e,r&&(t.moveTo(l-12e3*this.ray_x,y-12e3*this.ray_y),r=!1),t.lineTo(l,y))}t.lineTo(l-12e3*this.ray_x,y-12e3*this.ray_y),t.closePath(),t.fill(),t.globalCompositeOperation="source-over"}is_point_lit(t,e){for(let i of a.game_instance.lines)if(null!==i.instersect_ray(t,e,-this.ray_x,-this.ray_y))return!1;return!0}}},688:function(t,e,i){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.maps_list=void 0;const s=a(i(177)),o=a(i(576)),n=a(i(784));e.maps_list=[s.default,n.default,o.default]},647:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExitObject=e.GateObject=e.SwitchableObject=e.SwitchObject=e.MapObject=void 0;const a=i(607),s=i(874);class o{constructor(t,e,i){if(this.properties=new Map,this.x=t,this.y=e,i)for(let t of i)this.properties.set(t.name,t.value)}simulate(t){}draw(t){}in_interact_range(t,e){return!1}interact(){}string_property(t,e){let i=this.properties.get(e);return"string"==typeof i?i:t}opt_string_property(t){let e=this.properties.get(t);return"string"==typeof e?e:null}float_property(t,e){let i=this.properties.get(e);return"number"==typeof i?i:t}bool_property(t,e){let i=this.properties.get(e);return"boolean"==typeof i?i:t}draw_interact_icon(t,e,i){t.textAlign="center",t.textBaseline="middle",t.font="15px Verdana",t.fillStyle="black",t.fillText("E",e,i+1),t.fillStyle="white",t.fillText("E",e,i),t.strokeStyle="black",t.lineWidth=2,t.beginPath(),t.arc(e,i,10,0,2*Math.PI),t.stroke(),t.strokeStyle="white",t.beginPath(),t.arc(e,i-1,10,0,2*Math.PI),t.stroke()}}e.MapObject=o;class n extends o{constructor(t,e,i){super(t,e,i),this.is_on=!1,this.facing_right=!1,this.target_tag="",this.facing_right=this.bool_property(this.facing_right,"facing_right"),this.target_tag=this.string_property(this.target_tag,"target_tag"),this.is_on=this.bool_property(!1,"is_on"),this.update_tagged(!0)}draw(t){let e=0,i=64;this.is_on&&(i+=32),this.facing_right&&(e+=16),t.drawImage(a.game_instance.tileset_image,e,i,16,32,this.x-(this.facing_right?0:16),this.y-32,16,32),a.game_instance.player&&!a.game_instance.player.is_werewolf&&this.in_interact_range(a.game_instance.player.x,a.game_instance.player.y)&&this.draw_interact_icon(t,this.x,this.y-32)}in_interact_range(t,e){let i=t-this.x,a=e-this.y;return i*i+a*a<1024}interact(){this.is_on=!this.is_on,this.is_on?a.game_instance.switch_on_sound.play(1):a.game_instance.switch_off_sound.play(1),this.update_tagged()}update_tagged(t=!1){let e=this.target_tag.split("|");for(let i of e){i.startsWith("!")&&(i=i.substring(1));let e=a.game_instance.tagged_objects.get(i);e&&e.update_switch(this,t)}}}e.SwitchObject=n;class h extends o{constructor(t,e,i){super(t,e,i),this.tag=null,this.switches_on=new Set,this.tag=this.opt_string_property("tag"),this.tag&&a.game_instance.tagged_objects.set(this.tag,this)}update_switch(t,e=!1){let i=t.target_tag.split("|").includes("!"+this.tag);t.is_on!=i?this.switches_on.add(t):this.switches_on.delete(t)}}e.SwitchableObject=h;const r={wood_4:{sx:0,sy:48,width:128,height:16},wood_2:{sx:0,sy:32,width:64,height:16}},l=[[0,0],[0,1],[1,1],[1,0]];e.GateObject=class extends h{constructor(t,e,i){super(t,e,i),this.dx=0,this.dy=0,this.rotation_initial=0,this.rotation_final=0,this.transition_time=0,this.state=0,this.transition_target=0,this.lines=[];let o=this.properties.get("gate_type");if("string"!=typeof o)throw new Error("Missing gate type!");let h=r[o];if(!h)throw new Error("invalid gate type "+o);this.gate_type=h,this.dx=this.float_property(this.dx,"dx"),this.dy=this.float_property(this.dx,"dy"),this.rotation_initial=this.float_property(this.rotation_initial,"rotation_initial")*Math.PI/180,this.rotation_final=this.float_property(0,"rotation_final")*Math.PI/180,this.transition_time=this.float_property(0,"transition_time");for(let t=0;t<4;t++){let t=new s.Line(0,0,0,0);this.lines.push(t),a.game_instance.lines.push(t)}for(let t of a.game_instance.objects){if(!(t instanceof n))continue;let e=t.target_tag.split("|");this.tag&&(e.includes(this.tag)||e.includes("!"+this.tag))&&this.update_switch(t,!0)}this.update_collision()}simulate(t){if(this.state!=this.transition_target){let e=this.transition_target-this.state;console.log(t),this.state+=Math.min(Math.abs(e),t/this.transition_time)*Math.sign(e),this.update_collision()}}get rotation(){return this.rotation_final*this.state+this.rotation_initial*(1-this.state)}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(a.game_instance.tileset_image,this.gate_type.sx,this.gate_type.sy,this.gate_type.width,this.gate_type.height,this.dx,this.dy,this.gate_type.width,this.gate_type.height),t.restore()}update_switch(t,e=!1){super.update_switch(t),this.transition_target=this.switches_on.size>0?1:0,e&&(this.state=this.transition_target,this.update_collision())}update_collision(){let t=this.rotation,e=Math.cos(t),i=Math.sin(t),a=[];for(let t=0;t<l.length;t++){let s=this.dx+this.gate_type.width*l[t][0],o=this.dy+this.gate_type.height*l[t][1],n=s*e-o*i,h=s*i+o*e;n+=this.x,h+=this.y,a.push([n,h])}for(let t=0;t<this.lines.length;t++){let e=this.lines[t];e.x1=a[t][0],e.y1=a[t][1];let i=(t+1)%a.length;e.x2=a[i][0],e.y2=a[i][1]}}},e.ExitObject=class extends o{constructor(){super(...arguments),this.particles=[],this.particle_timer=0}simulate(t){for(a.game_instance.player&&Math.abs(a.game_instance.player.x-this.x)<20&&Math.abs(a.game_instance.player.y-this.y)<1&&a.game_instance.advance_map(),this.particle_timer-=t;this.particle_timer<0;){this.particle_timer+=.03;let t=Math.cos(Math.random()*Math.PI);this.particles.push([32*(Math.sign(t)-t),2+2*Math.random(),0])}for(let e=0;e<this.particles.length;e++)this.particles[e][2]+=t,this.particles[e][2]>1&&(this.particles.splice(e,1),e--)}draw(t){for(let e of this.particles)t.fillStyle=`rgba(128, 140, 255, ${1-e[2]})`,t.fillRect(this.x+e[0],this.y+64*-e[2],e[1],e[1]);t.drawImage(a.game_instance.tileset_image,96,64,64,32,this.x-32,this.y,64,32)}}},251:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerObject=void 0;const a=i(607),s=i(874);class o extends s.PhysicsObject{constructor(t=0,e=0){super(t,e,void 0,-12,-30,24,30),this.is_werewolf=!1,this.facing_right=!1}draw(t){let e=32,i=64;this.is_werewolf&&(e+=32),this.facing_right&&(i+=32),t.drawImage(a.game_instance.tileset_image,e,i,32,32,Math.round(this.x)-16,Math.round(this.y)-32,32,32)}jump(){this.touching_floor&&!this.is_werewolf&&(this.velocity_y=-750)}simulate(t){var e,i,s;let o=!!(null===(e=a.game_instance.moon)||void 0===e?void 0:e.is_point_lit(this.x+this.bound_x+this.bound_width/2,this.y+this.bound_y+this.bound_height/2));o!=this.is_werewolf&&(this.is_werewolf=o,this.is_werewolf&&!a.game_instance.awoo_playing&&(a.game_instance.awoo_playing=!0,setTimeout((()=>{a.game_instance.awoo_playing=!1}),4e3),a.game_instance.awoo_sound.play(.4*Math.random()+.8)));let n=null!==(s=null===(i=a.game_instance.moon)||void 0===i?void 0:i.get_moon_vector(this.x,this.y))&&void 0!==s?s:[0,0];(this==a.game_instance.player||this.is_werewolf)&&((this.is_werewolf?n[0]<0:a.game_instance.arrow_left&&!a.game_instance.arrow_right)?(this.touching_floor?this.velocity_x=-290:this.is_werewolf||(this.velocity_x=Math.max(this.velocity_x-2e3*t,Math.min(this.velocity_x,-290))),this.facing_right=!1):(this.is_werewolf?n[0]>0:a.game_instance.arrow_right&&!a.game_instance.arrow_left)&&(this.touching_floor?this.velocity_x=290:this.is_werewolf||(this.velocity_x=Math.min(this.velocity_x+2e3*t,Math.max(this.velocity_x,290))),this.facing_right=!0)),this.is_werewolf||(this.velocity_x<0?this.facing_right=!1:this.velocity_x>0&&(this.facing_right=!0)),this.is_werewolf&&this.touching_floor&&(this.velocity_y=-1100),super.simulate(t)}}e.PlayerObject=o},761:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sound=void 0;const a=i(607);e.Sound=class{constructor(t){this.buffer=null,fetch(t).then((async t=>{let e=await t.arrayBuffer();a.game_instance.audio_ctx.decodeAudioData(e,(t=>{this.buffer=t}),(t=>{console.error(t)}))}))}play(t=1){if(!this.buffer)return;let e=a.game_instance.audio_ctx.createBufferSource();e.buffer=this.buffer,e.connect(a.game_instance.audio_ctx.destination),e.playbackRate.value=t,e.start()}}}},e={};!function i(a){if(e[a])return e[a].exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,i),s.exports}(607)})();